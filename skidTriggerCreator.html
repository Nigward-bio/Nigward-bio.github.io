<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Chomik Trigger Creator üöÄ</title>
    <link rel="shortcut icon" href="chomik.jpg" type="image/jpeg">
    <!-- Use Fira Code font -->
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Include Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Define theme colors */
        :root {
          --bg-color: #0a0a0a;
          --container-bg: rgba(0, 0, 0, 0.5);
          --text-color: #c0c0c0; /* Light gray for general text */
          --primary-color: #7400d9; /* Purple from html.html */
          --accent-color: #7a03e0; /* Slightly different purple for accents */
          --border-color: rgba(122, 3, 224, 0.5); /* Purple border */
          --border-radius: 0.4rem; /* 6.4px */
          --font-family: 'Fira Code', monospace;
          --input-bg: #1a1a1a; /* Darker input background */
        }

        /* Basic page styling */
        html, body {
          height: 100%;
          margin: 0;
          padding: 0;
          font-family: var(--font-family);
          background-color: var(--bg-color);
          color: var(--text-color);
          opacity: 0;
          animation: fadeIn 1.5s forwards;
          overflow-x: hidden; /* Prevent horizontal scroll */
          overflow-y: auto; /* Allow vertical scroll if needed */
        }

        /* Add global custom cursor style */
        * {
          cursor: url(jojo/hqizezkx5r.cur) 0 0, auto !important;
          box-sizing: border-box; /* Include padding and border in element's total width and height */
        }

        /* Video Background */
        #video-bg { /* Changed ID */
          position: fixed;
          right: 0;
          bottom: 0;
          min-width: 100%;
          min-height: 100%;
          width: auto;
          height: auto;
          z-index: -10;
          object-fit: cover;
          filter: blur(2px) brightness(100%); /* Match html.html filter */
        }

        /* Click to Start Overlay Styles */
        #text-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.8);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 10002; /* Ensure it's above other content */
          cursor: pointer; /* Use default pointer for the overlay itself */
          transition: opacity 0.5s ease;
          opacity: 1; /* Start visible */
        }
        #text-overlay.hidden {
          opacity: 0;
          pointer-events: none; /* Disable interaction after hiding */
        }
        #click-text {
          color: white;
          font-size: 2em;
          font-weight: bold;
          font-family: var(--font-family); /* Match page font */
        }

        /* Main content wrapper - centered */
        .main-wrapper {
          display: flex;
          min-height: 100vh;
          padding: 2rem 0 2rem 0; /* Adjusted top padding */
          width: 100%;
          justify-content: center;
          align-items: center; /* Center vertically */
        }

        /* Main content container - similar to max-w-[42rem] */
        .container {
          max-width: 42rem;
          width: 90%; /* Fallback for smaller screens */
          margin: 0 auto; /* Center the container */
          padding: 0 1rem; /* px-4 equivalent */
          display: flex;
          flex-direction: column;
          gap: 0.75rem; /* gap-3 equivalent */
        }

        /* General component styling */
        .component {
          background-color: var(--container-bg);
          border-radius: var(--border-radius);
          border: 1px solid var(--border-color);
          padding: 1.5rem; /* Increased padding */
          backdrop-filter: blur(5px); /* Optional blur */
          transition: transform 0.3s ease, box-shadow 0.3s ease;
          width: 100%; /* Ensure component takes full width of container */
        }

        /* Mute button styling */
        #mute-button {
          position: fixed;
          top: 15px; /* Adjusted position */
          right: 15px;
          background-color: transparent;
          border: none;
          color: var(--text-color);
          font-size: 1.25rem; /* Adjusted size for icons */
          cursor: url('GTA 5 Web Cursor.cur'), pointer; /* Specific cursor */
          z-index: 1001; /* Above other elements */
          transition: transform 0.3s ease, color 0.3s ease;
          padding: 5px; /* Add some padding for easier clicking */
          line-height: 1; /* Ensure icon vertical alignment */
        }

        #mute-button:hover {
          transform: scale(1.1);
          color: var(--accent-color);
        }

        /* Form Specific Styles */
        #triggerForm {
            display: flex;
            flex-direction: column;
            align-items: center; /* Center items within the form */
            gap: 1rem; /* Space between form elements */
        }

        h1 {
            font-family: var(--font-family);
            font-size: 1.8em; /* Adjusted size */
            color: var(--primary-color);
            text-shadow: 0 0 5px rgba(116, 0, 217, 0.5);
            margin-bottom: 1rem; /* Space below heading */
            text-transform: uppercase;
            letter-spacing: 2px;
            white-space: nowrap;
        }

        label {
            color: var(--text-color);
            font-size: 0.9em;
            width: 100%; /* Make labels take full width */
            text-align: left; /* Align label text left */
            margin-bottom: -0.5rem; /* Reduce space below label */
        }

        input[type="text"],
        input[type="number"] {
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 10px;
            border-radius: var(--border-radius);
            font-family: var(--font-family);
            width: 100%;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="number"]:focus {
            outline: none;
            border-color: var(--accent-color); /* Highlight border on focus */
        }

        input::placeholder {
            color: rgba(192, 192, 192, 0.6); /* Lighter placeholder text */
        }

        button[type="button"] {
            background-color: var(--primary-color);
            color: white;
            outline: none;
            border: 1px solid var(--border-color);
            padding: 10px 20px;
            width: 100%;
            border-radius: var(--border-radius);
            cursor: pointer; /* Use default pointer for button */
            font-family: var(--font-family);
            margin-top: 10px;
            transition: filter 0.3s ease;
            font-weight: 600;
        }

        button[type="button"]:hover {
            filter: brightness(1.25);
        }

        /* Loop Checkboxes Container */
        .loop-checkboxes {
            display: flex;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
            align-items: center;
            justify-content: center; /* Center checkboxes */
            gap: 15px; /* Space between checkboxes */
            margin-bottom: 10px;
            width: 100%;
        }

        /* Checkbox Labels */
        .loop-checkboxes label {
            display: flex;
            align-items: center;
            gap: 8px; /* Space between checkbox and text */
            color: var(--text-color);
            cursor: pointer; /* Use default pointer */
            font-size: 0.9em;
            width: auto; /* Don't force full width */
            margin-bottom: 0; /* Reset margin */
            position: relative; /* Needed for tooltip */
        }

        input[type="checkbox"] {
            accent-color: var(--primary-color); /* Style the checkbox color */
            cursor: pointer; /* Use default pointer */
            width: 16px;
            height: 16px;
        }

        /* Tooltip Styles */
        [data-tooltip] {
            position: relative;
        }

        [data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 120%; /* Position above the label */
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.9); /* Dark background */
            color: var(--primary-color); /* Purple text */
            padding: 8px 12px;
            border-radius: var(--border-radius);
            font-size: 0.8em;
            font-weight: 600;
            white-space: pre-line; /* Preserve line breaks */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 1000;
            min-width: 220px; /* Minimum width */
            text-align: left;
            border: 1px solid var(--border-color);
        }

        [data-tooltip]:hover::after {
            opacity: 1;
            visibility: visible;
        }

        /* Conditional Input Containers */
        #loopCountContainer,
        #conditionContainer,
        #bindContainer,
        .delay-container { /* Use a class for delay */
            width: 100%;
            display: flex; /* Use flex for alignment */
            flex-direction: column; /* Stack label and input */
            gap: 0.5rem; /* Space between label and input */
        }

        #bindContainer {
            background-color: rgba(0, 0, 0, 0.2); /* Slightly different background */
            padding: 1rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            margin-top: 10px;
            gap: 1rem; /* Increase gap inside bind container */
        }

        #bindContainer input {
            margin-bottom: 0; /* Remove default margin */
        }

        p {
            color: var(--text-color);
            margin: 5px 0;
            font-size: 0.9em; /* Smaller text */
            text-align: center;
        }

        a {
            color: var(--accent-color); /* Use accent color for links */
            text-decoration: none;
            font-size: 0.9em; /* Smaller text */
            transition: color 0.3s ease;
        }

        a:hover {
            text-decoration: underline;
            color: var(--primary-color);
        }

        .redirect-link {
            color: #00ff00; /* Keep green for emphasis */
            margin-top: 10px;
        }

        /* Snowflake Styling */
        .snowflake {
          position: fixed; /* Use fixed to cover the viewport */
          top: -10%;
          color: #fff;
          font-size: 1em;
          user-select: none;
          pointer-events: none;
          animation: fall linear infinite;
          opacity: 0.8;
          z-index: 9998; /* Ensure snowflakes are behind overlay/nav but above background */
          will-change: transform, opacity; /* Performance hint for animations */
        }

        @keyframes fall {
          0% {
            transform: translateY(0) rotate(0deg);
            opacity: 0.8;
          }
          100% {
            transform: translateY(110vh) rotate(360deg);
            opacity: 0; /* Fade out at the bottom */
          }
        }

        /* Fade-in animations */
        @keyframes fadeIn {
          to { opacity: 1; }
        }

    </style>
</head>
<body>
    <!-- Video Background -->
    <video autoplay muted loop playsinline id="video-bg"> <!-- Changed ID and added playsinline -->
        <source src="background.mp4" type="video/mp4"> <!-- Kept original video source -->
        Your browser does not support HTML5 video.
    </video>

    <!-- Click to Start Overlay -->
    <div id="text-overlay">
        <p id="click-text">Click to Start</p>
    </div>

    <!-- Mute button -->
    <button id="mute-button" aria-label="Toggle sound">
      <i class="fas fa-volume-high"></i> <!-- Default icon -->
    </button>

    <!-- Main Content Wrapper -->
    <div class="main-wrapper">
        <div class="container">
            <!-- Form as a component -->
            <form id="triggerForm" class="component" autocomplete="off">
                <h1><i class="fas fa-bolt"></i> Trigger Creator</h1> <!-- Added icon -->

                <label for="param1">Trigger Name:</label> <!-- Changed label text -->
                <input type="text" id="param1" name="param1" required placeholder="e.g., esx:giveInventoryItem">

                <label for="param2">Trigger Parameters (JSON Array):</label> <!-- Changed label text -->
                <input type="text" id="param2" name="param2" required placeholder='e.g., ["item_id", "item_count"]'>

                <!-- Loop Checkboxes Container -->
                <div class="loop-checkboxes">
                    <label for="whileLoop" data-tooltip="Repeats indefinitely until manually stopped. Example in Lua:&#10;while true do&#10;    -- Code here&#10;end">
                        <input type="checkbox" id="whileLoop" name="whileLoop">
                        While Loop
                    </label>

                    <label for="forLoop" data-tooltip="Repeats a specific number of times. Example in Lua:&#10;for i = 1, 10 do&#10;    -- Code here&#10;end">
                        <input type="checkbox" id="forLoop"" name="forLoop">
                        For Loop
                    </label>

                    <label for="untilCheckmark" data-tooltip="Repeats until a specific condition is met. Example in Lua:&#10;repeat&#10;    -- Code here&#10;until condition">
                        <input type="checkbox" id="untilCheckmark" name="untilCheckmark">
                        Repeat Until
                    </label>

                    <label for="bindCheck" data-tooltip="Adds key binding to start/stop the trigger. Example:&#10;Press key to start running the trigger&#10;Press another key to stop">
                        <input type="checkbox" id="bindCheck" name="bindCheck">
                        Bind Keys
                    </label>
                </div>

                <!-- Delay Input (for While Loop) -->
                <div class="delay-container" style="display: none;"> <!-- Changed class and added container -->
                    <label for="delay">Delay (seconds):</label>
                    <input type="number" id="delay" name="delay" placeholder="Enter delay in seconds (e.g., 0.5)">
                </div>

                <!-- Loop Count Input (for For Loop) -->
                <div id="loopCountContainer" style="display: none;">
                    <label for="loopCount">Number of Repetitions:</label>
                    <input type="number" id="loopCount" name="loopCount" placeholder="Enter number of repetitions (e.g., 10)">
                </div>

                <!-- Condition Input (for Repeat Until) -->
                <div id="conditionContainer" style="display: none;">
                    <label for="condition">Condition:</label>
                    <input type="text" id="condition" name="condition" placeholder="Enter Lua condition (e.g., x > 10)">
                </div>

                <!-- Bind Input Container -->
                <div id="bindContainer" style="display: none;">
                    <label for="startKey">Start Key (A-Z):</label>
                    <input type="text" id="startKey" maxlength="1" style="text-transform: uppercase;" placeholder="Key to start (e.g., E)">

                    <label for="stopKey">Stop Key (A-Z):</label>
                    <input type="text" id="stopKey" maxlength="1" style="text-transform: uppercase;" placeholder="Key to stop (e.g., Y)">

                    <label for="bindDelay">Trigger Delay (seconds):</label>
                    <input type="number" id="bindDelay" placeholder="Delay between triggers (e.g., 1)">
                </div>

                <button type="button" onclick="change()">Generate Trigger</button>

                <p>A Free Chomik Trigger Creator</p>
                <p><a target="_blank" href="https://discord.gg/3pYc4cRCGP">Join My Discord</a></p>
                <p><a href="index.html" class="redirect-link">Return to main page</a></p> <!-- Updated link -->
            </form>
        </div>
    </div>

    <!-- Audio Element -->
    <audio id="background-music" src="jojo1.mp3" loop preload="auto"></audio> <!-- Added preload -->

    <script>
        // Constants and Validation (Keep original)
        const CONTROL_KEYS = {
            A: 34, B: 29, C: 26, D: 35, E: 38, F: 23, G: 47, H: 74,
            I: 311, J: 199, K: 311, L: 182, M: 244, N: 249, O: 245,
            P: 199, Q: 44, R: 45, S: 33, T: 245, U: 303, V: 0, W: 32,
            X: 73, Y: 246, Z: 20
        };

        function validateKeyInput(key) {
            if (!CONTROL_KEYS[key]) {
                alert("‚ùå Invalid key! Only letters A-Z are supported.");
                return null;
            }
            return CONTROL_KEYS[key];
        }

        // Checkbox Handling (Keep original logic, adapt show() slightly)
        function handleCheckboxChange() {
            let whileLoop = document.getElementById('whileLoop');
            let forLoop = document.getElementById('forLoop');
            let untilCheckmark = document.getElementById('untilCheckmark');
            let bindCheck = document.getElementById('bindCheck');
            const checkboxes = [whileLoop, forLoop, untilCheckmark, bindCheck];

            // Uncheck all other checkboxes except the current one
            if (this.checked) {
                checkboxes.forEach(checkbox => {
                    if (checkbox !== this) {
                        checkbox.checked = false;
                    }
                });
            }
            show(); // Update the visibility of input fields
        }

        document.getElementById('whileLoop').addEventListener('change', handleCheckboxChange);
        document.getElementById('forLoop').addEventListener('change', handleCheckboxChange);
        document.getElementById('untilCheckmark').addEventListener('change', handleCheckboxChange);
        document.getElementById('bindCheck').addEventListener('change', handleCheckboxChange);

        // Show/Hide Input Fields (Adapt for new delay container)
        function show() {
            let whileLoop = document.getElementById('whileLoop').checked;
            let forLoop = document.getElementById('forLoop').checked;
            let untilCheckmark = document.getElementById('untilCheckmark').checked;
            let bindCheck = document.getElementById('bindCheck').checked;
            let loopCountContainer = document.getElementById('loopCountContainer');
            let delayContainer = document.querySelector('.delay-container'); // Select by class
            let conditionContainer = document.getElementById('conditionContainer');
            let bindContainer = document.getElementById('bindContainer');

            // Hide all conditional containers initially
            delayContainer.style.display = 'none';
            loopCountContainer.style.display = 'none';
            conditionContainer.style.display = 'none';
            bindContainer.style.display = 'none';

            // Show the relevant container based on the checked box
            if (whileLoop) {
                delayContainer.style.display = 'flex'; // Use flex for consistency
            } else if (forLoop) {
                loopCountContainer.style.display = 'flex';
            } else if (untilCheckmark) {
                conditionContainer.style.display = 'flex';
            } else if (bindCheck) {
                bindContainer.style.display = 'flex';
            }
        }

        // Trigger Generation Logic (Keep original 'change' function)
        function change() {
            let triggerName = document.querySelector('#param1').value;
            let triggerParams = document.querySelector('#param2').value;
            let whileLoop = document.getElementById('whileLoop').checked;
            let forLoop = document.getElementById('forLoop').checked;
            let untilCheckmark = document.getElementById('untilCheckmark').checked;
            let bindCheck = document.getElementById('bindCheck').checked;
            let loopCountInput = document.getElementById('loopCount');
            let delayInput = document.getElementById('delay'); // Get delay input
            let conditionInput = document.getElementById('condition');
            let startKeyInput = document.getElementById('startKey');
            let stopKeyInput = document.getElementById('stopKey');
            let bindDelayInput = document.getElementById('bindDelay');

            if (!triggerName) {
                return alert('Please enter the Trigger Name.');
            }
            // Basic JSON validation for params
            try {
                JSON.parse(triggerParams);
            } catch (e) {
                 if (!triggerParams.startsWith('[') || !triggerParams.endsWith(']')) {
                     // Try wrapping if it doesn't look like an array
                     try {
                         triggerParams = `[${triggerParams.split(',').map(p => JSON.stringify(p.trim())).join(',')}]`;
                         JSON.parse(triggerParams); // Re-validate
                         document.querySelector('#param2').value = triggerParams; // Update input field if corrected
                     } catch (e2) {
                         return alert('Please enter valid JSON Array Parameters (e.g., ["param1", 123, true]) or comma-separated values.');
                     }
                 } else {
                    return alert('Please enter valid JSON Array Parameters (e.g., ["param1", 123, true]).');
                 }
            }


            let codeGenerated;

            if (whileLoop) {
                let delay = delayInput ? delayInput.value : 0;

                if (delay === '' || isNaN(delay) || delay < 0) { // Check if empty or not a non-negative number
                    return alert('Invalid Number in Delay. Please enter 0 or a positive number.');
                }

                codeGenerated = `CreateThread(function()\n`;
                codeGenerated += `    while true do\n`;
                codeGenerated += `        Wait(${parseFloat(delay)} * 1000)\n`; // Use parseFloat
                codeGenerated += `        local params = json.decode('${triggerParams}')\n`;
                codeGenerated += `        TriggerServerEvent('${triggerName}', table.unpack(params))\n`;
                codeGenerated += `    end\n`;
                codeGenerated += `end)`;
            } else if (forLoop) {
                let loopCount = loopCountInput.value;

                if (!loopCount || isNaN(loopCount) || parseInt(loopCount) <= 0) { // Use parseInt
                    return alert('Please enter a valid positive number of repetitions.');
                }

                codeGenerated = `CreateThread(function()\n`; // Wrap in thread for safety
                codeGenerated += `    for i = 1, ${parseInt(loopCount)} do\n`;
                codeGenerated += `        local params = json.decode('${triggerParams}')\n`;
                codeGenerated += `        TriggerServerEvent('${triggerName}', table.unpack(params))\n`;
                codeGenerated += `        Wait(0) -- Yield to prevent freezing\n`;
                codeGenerated += `    end\n`;
                codeGenerated += `end)`;
            } else if (untilCheckmark) {
                let condition = conditionInput ? conditionInput.value.trim() : '';

                if (!condition) {
                    return alert('Please enter a valid Lua condition.');
                }

                codeGenerated = `CreateThread(function()\n`;
                codeGenerated += `    repeat\n`;
                codeGenerated += `        local params = json.decode('${triggerParams}')\n`;
                codeGenerated += `        TriggerServerEvent('${triggerName}', table.unpack(params))\n`;
                codeGenerated += `        Wait(0) -- Yield to prevent freezing\n`;
                codeGenerated += `    until ${condition}\n`;
                codeGenerated += `end)`;
            } else if (bindCheck) {
                let startKey = startKeyInput ? startKeyInput.value.toUpperCase() : '';
                let stopKey = stopKeyInput ? stopKeyInput.value.toUpperCase() : '';
                let bindDelay = bindDelayInput ? bindDelayInput.value : 0;

                if (!startKey || !stopKey) {
                    return alert('Please enter valid start and stop keys (A-Z).');
                }

                if (startKey === stopKey) {
                    return alert("‚ùå Start and Stop keys cannot be the same!");
                }

                let startKeyCode = validateKeyInput(startKey);
                let stopKeyCode = validateKeyInput(stopKey);

                if (!startKeyCode || !stopKeyCode) {
                    return; // validateKeyInput shows the alert
                }

                if (bindDelay === '' || isNaN(bindDelay) || bindDelay < 0) { // Check if empty or not a non-negative number
                    return alert('Invalid Number in Trigger Delay. Please enter 0 or a positive number.');
                }

                // (Keep the generated code for bindCheck the same as original)
                codeGenerated = `local isRunning = false\n\n`;
                codeGenerated += `function notify(message)\n`;
                codeGenerated += `    SetNotificationTextEntry("STRING")\n`;
                codeGenerated += `    AddTextComponentString(message)\n`;
                codeGenerated += `    DrawNotification(false, false)\n`;
                codeGenerated += `end\n\n`;
                codeGenerated += `function DrawText3D(x, y, z, text)\n`;
                codeGenerated += `    local onScreen, _x, _y = World3dToScreen2d(x, y, z)\n`;
                codeGenerated += `    local px, py, pz = table.unpack(GetGameplayCamCoords())\n\n`;
                codeGenerated += `    SetTextScale(0.35, 0.35)\n`;
                codeGenerated += `    SetTextFont(4)\n`;
                codeGenerated += `    SetTextProportional(1)\n`;
                codeGenerated += `    SetTextEntry("STRING")\n`;
                codeGenerated += `    SetTextCentre(1)\n`;
                codeGenerated += `    AddTextComponentString(text)\n`;
                codeGenerated += `    DrawText(_x, _y)\n`;
                codeGenerated += `end\n\n`;
                codeGenerated += `CreateThread(function()\n`;
                codeGenerated += `    notify("Welcome! Press ${startKey} to start spawning, ${stopKey} to stop script")\n\n`;
                codeGenerated += `    while true do\n`;
                codeGenerated += `        Wait(0)\n\n`;
                codeGenerated += `        local playerPed = PlayerPedId()\n`;
                codeGenerated += `        local playerCoords = GetEntityCoords(playerPed)\n\n`;
                codeGenerated += `        if IsDisabledControlJustPressed(1, ${stopKeyCode}) then -- Check stop key first\n`;
                codeGenerated += `            notify("Script Terminated")\n`;
                codeGenerated += `            isRunning = false\n`;
                codeGenerated += `            return\n`;
                codeGenerated += `        end\n\n`;
                codeGenerated += `        if isRunning then\n`;
                codeGenerated += `            DrawText3D(playerCoords.x, playerCoords.y, playerCoords.z + 1.0, "Press ${startKey} to stop | ${stopKey} to exit script")\n`;
                codeGenerated += `        else\n`;
                codeGenerated += `            DrawText3D(playerCoords.x, playerCoords.y, playerCoords.z + 1.0, "Press ${startKey} to start running | ${stopKey} to exit script")\n`;
                codeGenerated += `        end\n\n`;
                codeGenerated += `        if IsDisabledControlJustPressed(1, ${startKeyCode}) then\n`; // Use IsDisabledControlJustPressed
                codeGenerated += `            if isRunning then\n`;
                codeGenerated += `                isRunning = false\n`;
                codeGenerated += `                notify("Stopped")\n`;
                codeGenerated += `            else\n`;
                codeGenerated += `                isRunning = true\n`;
                codeGenerated += `                notify("Running...")\n`;
                codeGenerated += `                CreateThread(function()\n`;
                codeGenerated += `                    while isRunning do\n`;
                codeGenerated += `                        local params = json.decode('${triggerParams}')\n`;
                codeGenerated += `                        TriggerServerEvent('${triggerName}', table.unpack(params))\n`;
                codeGenerated += `                        Wait(${parseFloat(bindDelay)} * 1000)\n`; // Use parseFloat
                codeGenerated += `                    end\n`;
                codeGenerated += `                end)\n`;
                codeGenerated += `            end\n`;
                codeGenerated += `        end\n`;
                // Removed the second stop key check as it's handled at the top
                codeGenerated += `    end\n`;
                codeGenerated += `end)`;

            } else {
                // Default case: No loop/bind selected - trigger once
                codeGenerated = `CreateThread(function()\n`;
                codeGenerated += `    local params = json.decode('${triggerParams}')\n`;
                codeGenerated += `    TriggerServerEvent('${triggerName}', table.unpack(params))\n`;
                codeGenerated += `end)`;
            }

            navigator.clipboard.writeText(codeGenerated)
                .then(() => {
                    alert('‚úî - Trigger has been copied to your clipboard!');
                })
                .catch(err => {
                    console.error('Failed to copy text: ', err);
                    alert('‚ùå - Failed to copy trigger. Check console for errors.');
                });
        }

        // --- New/Merged JavaScript from index.html ---

        // Click to start overlay
        const overlay = document.getElementById('text-overlay');
        const clickText = document.getElementById('click-text');
        const backgroundMusic = document.getElementById('background-music'); // Use correct ID
        const videoBg = document.getElementById('video-bg');

        // Video cycling (optional - keeping single loop for now)
        // const backgroundVideos = ["background.mp4"]; // Add more if needed
        // let currentVideoIndex = 0;
        // function playNextVideo() { ... }
        // videoBg.addEventListener('ended', playNextVideo);

        if (overlay && clickText && backgroundMusic && videoBg) {
            overlay.addEventListener('click', function() {
                overlay.classList.add('hidden');
                initializeMuteState(); // Initialize mute state based on localStorage
                backgroundMusic.play().catch(error => {
                    console.log("Background music autoplay failed:", error);
                    // Autoplay might be blocked, user interaction (like click) usually enables it.
                });
                videoBg.play().catch(error => {
                    console.log("Background video autoplay failed:", error);
                });
            }, { once: true });
        } else {
            console.error("Overlay, click text, background music, or video background element not found.");
            if(overlay) overlay.style.display = 'none'; // Hide overlay if elements are missing
        }

        // Mute button functionality
        const muteButton = document.getElementById('mute-button');
        const muteIcon = muteButton.querySelector('i');
        // Select all audio elements if there were more, otherwise just the one
        const audioElements = [backgroundMusic]; // Use an array
        let isMuted = localStorage.getItem('muted') === 'true'; // Load initial state

        function updateMuteStatus(muted) {
          isMuted = muted;
          audioElements.forEach(audio => {
            if (audio) audio.muted = isMuted; // Check if audio element exists
          });
          if (muteIcon) muteIcon.className = isMuted ? 'fas fa-volume-xmark' : 'fas fa-volume-high'; // Update icon
          localStorage.setItem('muted', isMuted); // Save state
          if (muteButton) muteButton.setAttribute('aria-label', isMuted ? 'Unmute sound' : 'Mute sound');
        }

        function toggleMute() {
          updateMuteStatus(!isMuted);
        }

        function initializeMuteState() {
          // Apply initial mute state without saving it again
          isMuted = localStorage.getItem('muted') === 'true';
          audioElements.forEach(audio => {
            if (audio) audio.muted = isMuted;
          });
           if (muteIcon) muteIcon.className = isMuted ? 'fas fa-volume-xmark' : 'fas fa-volume-high';
           if (muteButton) muteButton.setAttribute('aria-label', isMuted ? 'Unmute sound' : 'Mute sound');
        }

        if (muteButton) {
            muteButton.addEventListener('click', toggleMute);
        }
        // Don't call initializeMuteState here, call it after overlay click

        // Optimized snowflake effect with DOM element limit
        const MAX_SNOWFLAKES_CREATOR = 30;
        let activeSnowflakesCreator = 0;

        function createSnowflake() {
          // Prevent creating too many snowflakes
          if (activeSnowflakesCreator >= MAX_SNOWFLAKES_CREATOR) {
            return;
          }

          activeSnowflakesCreator++;
          const snowflake = document.createElement('div');
          snowflake.innerHTML = '‚ùÑ';
          snowflake.classList.add('snowflake');
          snowflake.style.left = Math.random() * 100 + 'vw';
          const duration = Math.random() * 10 + 10; // 10-20 seconds fall time
          snowflake.style.animationDuration = duration + 's';
          snowflake.style.opacity = Math.random() * 0.5 + 0.3; // 0.3 - 0.8 opacity
          snowflake.style.fontSize = Math.random() * 10 + 10 + 'px'; // 10px - 20px size

          document.body.appendChild(snowflake);

          // Flag to prevent double cleanup
          let cleaned = false;
          
          function cleanup() {
            if (cleaned) return;
            cleaned = true;
            if (snowflake.parentNode) {
              snowflake.remove();
            }
            activeSnowflakesCreator = Math.max(0, activeSnowflakesCreator - 1);
          }

          // Use animationend event for accurate cleanup
          snowflake.addEventListener('animationend', cleanup, { once: true });

          // Fallback timeout
          setTimeout(cleanup, (duration + 2) * 1000);
        }

        function startSnowfall() {
          const currentMonth = new Date().getMonth() + 1; // Get the current month (1‚Äì12)
          // Only snow in December, January, February
          if (currentMonth === 12 || currentMonth === 1 || currentMonth === 2) {
            if (!window.snowfallInterval) {
              window.snowfallInterval = setInterval(createSnowflake, 800); // Reduced frequency from 500ms to 800ms
            }
          }
        }

        // Start snowfall on load (if it's winter)
        startSnowfall();

        // Initial call to set correct input visibility on page load
        document.addEventListener('DOMContentLoaded', show);

    </script>
</body>
</html>
